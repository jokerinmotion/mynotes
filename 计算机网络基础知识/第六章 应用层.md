> \5. 应用层
>     \1. 掌握DNS协议
>         \1. 名字空间
>         \2. 指针查询（反向查找或逆向解析）基本原理
>         \3. DNS缓存
>     \2. FTP协议（活化石）：
>         \1. 控制流和数据流
>         \2. 两种工作模式： PASV 和 PORT
>         \3. 各种指令和响应码
>         \4. 断点续传和匿名FTP的概念
>     \5. HTTP协议： 
>         \1. 报文格式：请求报文，响应报文，请求头各种字段，响应头各种字段
>         \2. HTTP状态码
>     \2. HTTPS协议
>         \1. 握手的详细过程
>         \2. 摘要算法，数字签名，数字证书的原理和过程

# 第六章 应用层

## 6.1 概述

![image-20210829143247919](images/image-20210829143247919.png)

![image-20210829143325265](images/image-20210829143325265.png)

![image-20210829143440434](images/image-20210829143440434.png)

## 6.2 客户-服务器方式和对等方式

![image-20210829143549776](images/image-20210829143549776.png)

### 客户/服务器方式(C/S)

![image-20210829143737932](images/image-20210829143737932.png)

![image-20210829143800579](images/image-20210829143800579.png)

### 对等方式（Peer to Peer，P2P）

![image-20210829144011508](images/image-20210829144011508.png)

![image-20210829144033971](images/image-20210829144033971.png)

### 小结

![image-20210829144103618](images/image-20210829144103618.png)



## 6.3 动态主机配置协议DHCP

### 作用

DHCP (Dynamic Host Configuration Protocol) 提供了即插即用的连网方式，用户不再需要手动配置 IP 地址等信息。

DHCP 配置的内容不仅是 IP 地址，还包括子网掩码、网关 IP 地址。

![image-20210829150015511](images/image-20210829150015511.png)

### 工作过程

DHCP使用C/S方式。DHCP是TCP/IP协议体系中的协议，使用运输层的UDP提供的服务（DHCP服务器UDP端口是67，DHCP客户使用的UDP端口是68）

（一）客户端发送 **Discover 报文**（DHCP发现报文），**该报文的目的地址为 255.255.255.255:67，源地址为 0.0.0.0:68**，被放入 UDP 中，该报文被广播到同一个子网的所有主机上。如果客户端和 DHCP 服务器不在同一个子网，就需要使用中继代理。

![image-20210829150719553](images/image-20210829150719553.png)

DHCP报文的格式比较复杂，对于发现报文，其内部封装有事务ID和DHCP客户端的MAC地址。







（二）DHCP 服务器收到 Discover 报文之后，根据其中封装的DHCP客户端的MAC地址查找自己的数据库，看是否有针对该MAC地址的配置信息。

如果有，则使用这些配置信息构建**DHCP 提供报文（Offer）**。如果没有，则采用默认配置信息来构建并发送DHCP提供报文。

**因为客户端可能收到多个 DHCP 服务器提供的信息，因此客户端需要进行选择（一般选择先到的那个）**。

![image-20210829151209391](images/image-20210829151209391.png)

DHCP服务器再给DHCP客户挑选IP地址时，使用ARP来确保IP地址未被占用：

![image-20210829151559499](images/image-20210829151559499.png)





（三）如果客户端选择了某个 DHCP 服务器提供的信息，那么就发送**DHCP请求报文（ Request 报文）**给该 DHCP 服务器。

源地址仍为0.0.0.0，因为此时DHCP客户才从多个DHCP服务器中挑选一个作为自己的DHCP服务器，它首先需要争得改服务器的同意，之后才能正式使用向该DHCP服务器租用的IP地址；

目的地址为广播地址，不需要单播发送。

DHCP请求报文中封装信息如下：

![image-20210829151815426](images/image-20210829151815426.png)





（四）DHCP 服务器发送 **DHCP确认报文（Ack 报文**），表示客户端此时可以使用提供给它的信息。

DHCP客户在使用IP地址前，也会使用ARP检测：

![image-20210829152241481](images/image-20210829152241481.png)

当租用期过了一半时，DHCP客户会向DHCP服务器发送DHCP请求报文，来请求更新租用期。DHCP服务器的反应有以下三种情况：

![image-20210829152531701](images/image-20210829152531701.png)

DHCP客户可以随时提前终止DHCP服务器所提供的租用期，只需发送**DHCP释放报文段**即可：

![image-20210829152734314](images/image-20210829152734314.png)

### 中继代理



![image-20210829153154661](images/image-20210829153154661.png)

解决办法：给路由器配置DHCP服务器的IP地址，使之成为DHCP中继代理

![image-20210829153322312](images/image-20210829153322312.png)

### 小结

![image-20210829153343439](images/image-20210829153343439.png)



## 💡6.4 域名系统DNS(Domain Name System)

> . 掌握DNS协议
>         \1. 名字空间
>         \2. 指针查询（反向查找或逆向解析）基本原理
>         \3. DNS缓存

### DNS的作用

对于大多数网络应用，一般使用域名来访问目的主机，而不是IP地址。

在浏览器输入域名时：

用户主机首先在自己的DNS高速缓存中查找该域名所对应的IP地址，如果没有找到，则会向网络中的某台DNS服务器查询。

<img src="images/image-20210829153956278.png" alt="image-20210829153956278" style="zoom: 33%;" />

<img src="images/image-20210829154012179.png" alt="image-20210829154012179" style="zoom:50%;" />





### 层次树状结构的域名结构

![image-20210829154059821](images/image-20210829154059821.png)

![image-20210829154211401](images/image-20210829154211401.png)

#### 顶级域名

![image-20210829154412604](images/image-20210829154412604.png)

#### 因特网的域名空间

![image-20210829154529202](images/image-20210829154529202.png)





### 域名服务器

![image-20210829154646604](images/image-20210829154646604.png)



### 域名解析的过程

#### 递归查询

<img src="images/image-20210829155311604.png" alt="image-20210829155311604" style="zoom:50%;" />

#### 迭代查询

<img src="images/image-20210829155445081.png" alt="image-20210829155445081" style="zoom: 50%;" />

#### 高速缓存

![image-20210829160356992](images/image-20210829160356992.png)

![image-20210829160413115](images/image-20210829160413115.png)



### 课上习题

<img src="images/image-20210829160603973.png" alt="image-20210829160603973" style="zoom: 33%;" />

<img src="images/image-20210829160734431.png" alt="image-20210829160734431" style="zoom:33%;" />

### 小结

![image-20210829160802943](images/image-20210829160802943.png)





## 6.5 文件传送协议FTP

>   \2. FTP协议（活化石）：
>         \1. 控制流和数据流
>         \2. 两种工作模式： PASV 和 PORT
>         \3. 各种指令和响应码
>         \4. 断点续传和匿名FTP的概念

![image-20210829160859446](images/image-20210829160859446.png)

![image-20210829162102605](images/image-20210829162102605.png)

### 应用举例

ftp采用C/S方式，

<img src="images/image-20210829161558522.png" alt="image-20210829161558522" style="zoom: 50%;" />

可以使用操作系统自带的FTP服务器软件，创建一个FTP服务器站点：

<img src="images/image-20210829161625971.png" alt="image-20210829161625971" style="zoom:33%;" />

则可以在客户计算机中使用浏览器通过创建的IP地址来访问FTP服务器，或者系统自带的命令行工具访问FTP服务器：

<img src="images/image-20210829161925315.png" alt="image-20210829161925315" style="zoom: 50%;" />

<img src="images/image-20210829161944397.png" alt="image-20210829161944397" style="zoom:33%;" />

也可以使用FTP客户端工具：

<img src="images/image-20210829162011575.png" alt="image-20210829162011575" style="zoom: 50%;" />

### 💡基本工作原理

#### 主动模式

![image-20210829162239126](images/image-20210829162239126.png)

#### 被动模式

<img src="images/image-20210829162439033.png" alt="image-20210829162439033" style="zoom: 50%;" />

### 课上习题

<img src="images/image-20210829162614854.png" alt="image-20210829162614854" style="zoom:50%;" />

<img src="images/image-20210829162626044.png" alt="image-20210829162626044" style="zoom:50%;" />

### 小结

![image-20210829162739943](images/image-20210829162739943.png)



## 6.6 电子邮件

![image-20210829162908658](images/image-20210829162908658.png)

### 主要构件

电子邮件系统使用C/S方式，电子邮件系统的三个主要构件：

- 用户代理

- 邮件服务器
- 电子邮件所需的协议

#### 用户代理

![image-20210829163211888](images/image-20210829163211888.png)

#### 邮件服务器

![image-20210829163458398](images/image-20210829163458398.png)

#### 邮件协议

![image-20210829163609618](images/image-20210829163609618.png)



### 发送过程

![image-20210829163803239](images/image-20210829163803239.png)



### 简单邮件传送协议SMTP

SMTP客户与服务器之间通过命令与应答的交互方式，最终实现SMTP客户发送邮件给SMTP服务器：

![image-20210829164325105](images/image-20210829164325105.png)

#### 具体过程

![image-20210829165153625](images/image-20210829165153625.png)

- 电子邮件信息格式

![image-20210829165249725](images/image-20210829165249725.png)

#### 多用途因特网邮件扩展MIME

![image-20210829165532246](images/image-20210829165532246.png)

![image-20210829165559562](images/image-20210829165559562.png)

### 邮件读取协议

![image-20210829165754784](images/image-20210829165754784.png)

![image-20210829165806012](images/image-20210829165806012.png)



### 基于万维网的电子邮件

![image-20210829170004596](images/image-20210829170004596.png)

### 课上习题

![image-20210829170809026](images/image-20210829170809026.png)



### 小结

![image-20210829170838097](images/image-20210829170838097.png)

