# 第三章 数据链路层

## 3.1 数据链路层概述

- 数据链路层在网络结构体系中的地位

主机H1给主机H2发送数据的过程（从五层结构体系来看）：

<img src="images/image-20210630145232334.png" alt="image-20210630145232334" style="zoom:50%;" />

在研究数据链路层时，可以简化为：

<img src="images/image-20210630145632930.png" alt="image-20210630145632930" style="zoom:40%;" />

- 数据链路层的基本概念：

![image-20210630145514386](images/image-20210630145514386.png)

- 数据链路层的三个重要问题（使用点对点信道的数据链路层举例）

1. 封装成帧：数据链路层给网络层交付的协议数据单元添加帧头和帧尾的操作

<img src="images/image-20210630145805270.png" alt="image-20210630145805270" style="zoom:50%;" />

2. 差错检测：接收方主机根据帧尾中的检错码检测帧中是否有误码

> 误码：比特0可能变成比特1，反之亦然

<img src="images/image-20210630150206864.png" alt="image-20210630150206864" style="zoom: 50%;" />

3. 可靠传输：

<img src="images/image-20210630150448716.png" alt="image-20210630150448716" style="zoom:50%;" />

- 数据链路层的其他问题（特别对于使用广播信道的数据链路层）

1. 地址/编址问题

![image-20210630150832738](images/image-20210630150832738.png)

- 碰撞问题（对于共享局域网而言）

![image-20210630151033691](images/image-20210630151033691.png)

- 其他问题：
  ![image-20210630151227302](images/image-20210630151227302.png)

![image-20210630151244464](images/image-20210630151244464.png)

以及包括：

- 集线器（物理层互连设备）和交换机（和网桥一样是数据链路层互连设备）的区别

## 3.2 封装成帧

### 帧头和帧尾

- 帧头和帧尾包含重要控制信息（如下所示）

  <img src="images/image-20210630151929653.png" alt="image-20210630151929653" style="zoom: 50%;" />

- 帧头和帧尾的作用之一是==帧定界==（但并不是所有的帧都包含帧定界标志）

<img src="images/image-20210630152145939.png" alt="image-20210630152145939" style="zoom:50%;" />

- 但并不是所有帧都包含帧定界标志，以下就是MAC帧的例子：

<img src="images/image-20210630152807981.png" alt="image-20210630152807981" style="zoom: 33%;" />

<img src="images/image-20210630152904378.png" alt="image-20210630152904378" style="zoom:33%;" />

### 透明传输

**数据链路层对上层交付的传输数据没有任何限制**，就好像数据链路层不存在一样

- 面向字节的物理链路，使用字节填充（或称字符填充）的方法来实现透明传输。
  - 比如，采用添加转移字符ESC（长度1个字节，十进制为27）的方法：

![image-20210630154158767](images/image-20210630154158767.png)

- 面向比特的物理链路使用比特填充的方法实现透明传输
  - 比如，采用零比特填充法：

![image-20210630154631351](images/image-20210630154631351.png)

零比特填充法考题：

<img src="images/image-20210630155100158.png" alt="image-20210630155100158" style="zoom:33%;" />

### 最大传送单元（MTU）

![image-20210630155347906](images/image-20210630155347906.png)

## 3.3 差错检测

**比特差错**和**误码率BER(Bit Error Rate)**

![image-20210630155738024](images/image-20210630155738024.png)

使用**差错检测码**来检测数据在传输过程中是否产生了比特差错，是数据链路层的重要问题

### 奇偶校验

在待发送的数据后面**添加1位奇偶校验位**，使整个数据（包括所添加的校验位在内）中”1“的个数为奇数（奇校验）或偶数（偶校验）

![image-20210630161744479](images/image-20210630161744479.png)

由于奇偶校验的漏检率比较高，因此计算机网络的数据链路层一般不会采用这种检验方法。

### 循环冗余校验CRC(Cyclic Redundancy Check)

CRC操作过程如下：

![image-20210630162021583](images/image-20210630162021583.png)

发送方的操作如下：

<img src="images/image-20210630162348612.png" alt="image-20210630162348612" style="zoom:50%;" />

接收方的操作如下：

<img src="images/image-20210630162421133.png" alt="image-20210630162421133" style="zoom:50%;" />

生成多项式举例：
![image-20210630162650851](images/image-20210630162650851.png)

例题1：
![image-20210630162746725](images/image-20210630162746725.png)

![image-20210630162806856](images/image-20210630162806856.png)

![image-20210630162931257](images/image-20210630162931257.png)

其中，图中加号表示**异或运算**

![image-20210630163145112](images/image-20210630163145112.png)

最后发送的数据为：101001001（最后的001为余数）

例题2：

![image-20210630163408634](images/image-20210630163408634.png)

![image-20210630163450584](images/image-20210630163450584.png)

## 3.4 可靠传输

### 3.4.1基本概念

