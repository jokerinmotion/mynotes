> \4. 传输层
>     \1. UDP，次要一点，掌握特点和首部各个字段
>     \2. 掌握TCP
>         \1. 特点 + 首部字段 + 可靠机制
>         \2. 连接控制 ： 三次握手，四次挥手，同时打开，同时关闭，半关闭（可能问到为什么需要）
>         \3. 流量控制机制：滑动窗口,慢启动，拥塞避免，快速重传，快速恢复
>         \4. 超时重传机制

# 第五章 运输层

## 5.1 概述

### 运输层的作用范围

![image-20210827204604329](images/image-20210827204604329.png)

### 计算机网络体系结构的角度理解运输层

![image-20210827205149639](images/image-20210827205149639.png)

注意，以上端口并非物理端口，而是**指用来区分不同应用进程的标识符。**

为了简单起见，可以理解为运输层直接为应用进程间的逻辑通信提供服务，如下图所示：

![image-20210827205437666](images/image-20210827205437666.png)

### 小结

![image-20210827205504546](images/image-20210827205504546.png)



## 5.2 端口号、复用、分用的概念

### 端口号

![image-20210827213221090](images/image-20210827213221090.png)



### 发送方的复用和接收方的分用

![image-20210827214753728](images/image-20210827214753728.png)

![image-20210827214915942](images/image-20210827214915942.png)

### 运输层端口号的作用——实例

用户PC、DNS服务器、Web服务器通过交换机进行互连，处于同一个以太网中。

DNS服务器中记录有：Web服务器的域名所对应的IP地址

例子：

![image-20210827231533298](images/image-20210827231533298.png)

DNS查询请求报文——UDP用户数据报（DNS查询请求）——UDP用户数据报（DNS响应）——TCP报文段（HTTP请求报文）——TCP报文段（HTTP响应报文）

其他图片略。



## 5.3 UDP和TCP的对比

UDP，User Datagram Protocol，用户数据报协议

TCP，Transmission Control Protocol，传输控制协议

### 数据传输

![image-20210828095119864](images/image-20210828095119864.png)

### 支持的通信

![image-20210828095311734](images/image-20210828095311734.png)

### 对应用报文的处理

UDP对应用进程交下来的报文既不合并也不拆分，而且保留这些报文的边界，即**UDP是面向应用报文**的。

而发送方的TCP把应用进程交付下来的数据块仅仅看作是一连串的、无结构的字节流，TCP并不知道这些待传送的字节流的含义，仅讲它们编号并存储在自己的**发送缓存**中。TCP根据发送策略，从发送缓存中提取一定数量的字节，构建TCP报文段并发送。

接收方的TCP一方面从接收到的TCP报文段中，取出数据载荷并存储在接收缓存中；一方面将接收缓存中的一些字节交付给应用进程。

TCP**不保证**接收方应用进程所收到的数据块与发送方应用进程所发出的数据块具有对应大小的关系。（例如，发送方应用进程交给发送方的TCP共10个数据块，但接收方的TCP可能只用了4个数据块就把收到的字节流交付给了上层的应用进程。）但接收方应用进程收到的字节流必须和发送方应用进程发出的字节流完全一样。接收方的应用进程必须有能力识别收到的字节流，并还原成有有意义的应用层数据。**TCP是面向字节流的。**![image-20210828101007914](images/image-20210828101007914.png)

### 提供的服务

![image-20210828101518373](images/image-20210828101518373.png)

### 首部格式

![image-20210828101627639](images/image-20210828101627639.png)

### 小结

![image-20210828101650920](images/image-20210828101650920.png)



## 5.4 TCP的流量控制

![image-20210828101817140](images/image-20210828101817140.png)



TCP接收方利用自己的**==接收窗口==**的大小来限制发送方**==发送窗口==**的大小；

TCP发送方收到接收方的**==零窗口通知==**后，应启动==**持续计时器**==。持续计时器超时后，向接收方发送**==零窗口探测报文==**。

![image-20210828104702148](images/image-20210828104702148.png)

![image-20210828104717078](images/image-20210828104717078.png)

![image-20210828104738061](images/image-20210828104738061.png)



## 5.5 TCP的拥塞控制

